---
phase: 7.10.1-simplify-scriptmanager
plan: 04
type: execute
---

<objective>
Clean up remaining comments and conduct comprehensive testing to verify all simplifications work correctly.

Purpose: Remove all "CRITICAL FIX" comments, empty logging blocks, and outdated TODOs. Verify through testing that no functionality is broken.
Output: Clean codebase with no legacy fix comments, and verified functionality through unit tests and manual testing.
</objective>

<execution_context>
~/.config/opencode/get-shit-done/workflows/execute-phase.md
./summary.md
~/.config/opencode/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/7.10-audit-simplify-scriptmanager/7.10-07-IMPLEMENTATION-PLAN.md
@src/core/ScriptManager.h
@src/core/ScriptManager.cpp
@src/shell/CodeShell.h
@src/shell/CodeShell.cpp
@src/core/Engine.h
@src/core/Engine.cpp

**Tech stack available:**
- Standard C++ build tools
- Xcode for macOS development

**Established patterns:**
- State observer callbacks
- Command queue processing
- State snapshots

**Constraining decisions:**
- Phase 7.10: Clean up all "CRITICAL FIX" comments
- Phase 7.10: Remove empty logging blocks
- Phase 7.10: Update comments to reflect simplified architecture

**Key files:**
- All files modified in previous plans need final cleanup

**Issues being addressed:**
- Code cleanliness after major refactoring
- Verification of no regressions
</context>

<tasks>

<task type="auto">
  <name>Task 1: Clean Up Comments and Legacy Fixes</name>
  <files>src/core/ScriptManager.h, src/core/ScriptManager.cpp, src/shell/CodeShell.h, src/shell/CodeShell.cpp, src/core/Engine.h, src/core/Engine.cpp</files>
  <action>
Remove all "CRITICAL FIX" comments from all files modified in this phase:
```bash
# Find all CRITICAL FIX comments
grep -rn "CRITICAL FIX" src/core/ScriptManager.h src/core/ScriptManager.cpp src/shell/CodeShell.h src/shell/CodeShell.cpp src/core/Engine.h src/core/Engine.cpp
```

Remove each occurrence and replace with appropriate documentation or remove entirely.

Remove any TODO comments that have been addressed by this simplification work.

Update comments to accurately reflect the simplified architecture (e.g., "single atomic guard" instead of "4 nested guards").
  </action>
  <verify>grep -rn "CRITICAL FIX" src/core/ScriptManager.h src/core/ScriptManager.cpp src/shell/CodeShell.h src/shell/CodeShell.cpp src/core/Engine.h src/core/Engine.cpp | wc -l == 0</verify>
  <done>No "CRITICAL FIX" comments remain in any modified files</done>
</task>

<task type="auto">
  <name>Task 2: Build Verification</name>
  <files>src/core/ScriptManager.h, src/core/ScriptManager.cpp, src/shell/CodeShell.h, src/shell/CodeShell.cpp, src/core/Engine.h, src/core/Engine.cpp</files>
  <action>
Run a full build to verify all changes compile correctly:
```bash
xcodebuild -project videoTracker.xcodeproj -scheme videoTracker build 2>&1 | tail -50
```

Fix any compilation errors that arise from the changes.
  </action>
  <verify>xcodebuild -project videoTracker.xcodeproj -scheme videoTracker build 2>&1 | grep -c "BUILD SUCCEEDED" == 1</verify>
  <done>Build succeeds with no errors</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Phase 7.10.1 simplified codebase - ScriptManager, CodeShell, and Engine with reduced complexity</what-built>
  <how-to-verify>
    Run the application and test script editing functionality:
    
    1. Build and run the application: `xcodebuild -project videoTracker.xcodeproj -scheme videoTracker build && open videoTracker.xcodeproj`
    2. Navigate to CodeShell
    3. Test script editing:
       - Type in the editor (should enter EDIT mode)
       - Execute script (CMD+R or equivalent)
       - Verify no crashes during editing
    4. Test state synchronization:
       - Make changes via other shells (CommandShell, EditorShell)
       - Verify state changes propagate to CodeShell
    5. Test editor mode transitions:
       - Switch between VIEW and EDIT modes
       - Verify auto-evaluation behavior
    6. Test script execution:
       - Execute scripts multiple times
       - Verify synchronous execution works
  </how-to-verify>
  <resume-signal>Type "approved" if all tests pass, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
- [ ] No "CRITICAL FIX" comments remain in any modified files
- [ ] `xcodebuild` build succeeds
- [ ] Script editing doesn't crash
- [ ] State changes propagate to editor
- [ ] Script execution works (synchronous)
- [ ] Editor mode transitions work (VIEW â†” EDIT)
- [ ] Auto-evaluation works
- [ ] Rapid script edits work
- [ ] Shell navigation works
</verification>

<success_criteria>

- Task 1 complete: No legacy fix comments, clean codebase
- Task 2 complete: Build succeeds
- Task 3 complete: Manual testing passes (human verified)
- All simplifications from Phase 7.10.1 working correctly
- No crashes during script editing
- State synchronization works correctly
</success_criteria>

<output>
After completion, create `.planning/phases/7.10.1-simplify-scriptmanager/7.10.1-04-SUMMARY.md` following the summary template.

After all 4 plans complete, create `.planning/phases/7.10.1-simplify-scriptmanager/SUMMARY.md` to summarize the entire phase.
</output>
