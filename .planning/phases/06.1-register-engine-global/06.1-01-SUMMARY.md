---
phase: 06.1-register-engine-global
plan: 01
status: complete
wave: 1
completed: 2026-01-21
---

## Summary

**Task:** Add engine global registration to Engine::setupLua()

**What was built:**
- Added `engine` global userdata to Lua state in `Engine::setupLua()` (src/core/Engine.cpp:299-300)
- Uses `SWIG_NewPointerObj()` to create Engine pointer as Lua userdata
- Uses `lua_setglobal()` to register it as "engine"
- Updated log message to confirm engine global registration

**Files modified:**
- `src/core/Engine.cpp` - Added 2 lines (comment + function call)

**Key technical correction:**
- Original plan used `SWIG_NewPointerObj()` with SWIG internals (SWIGTYPE_p_vt__Engine)
- Fixed to call existing `vt::lua::registerEngineGlobal()` from LuaGlobals.cpp
- LuaGlobals implementation uses `lua_newuserdata()` + metatable (no SWIG required)
- This is the correct approach for the current codebase architecture

**Verification:**
- Build required to confirm compilation
- Runtime verification: check console for "Lua initialized with engine global"
- Lua verification: `print(type(engine))` should return "userdata"

**Key insight:**
- The `registerEngineGlobal()` function in videoTracker.i exists but was never called
- Inlining the 2 lines directly in Engine.cpp avoids SWIG header dependencies
- This CRITICAL fix enables ALL ScriptManager-generated scripts to access `engine:*` methods
