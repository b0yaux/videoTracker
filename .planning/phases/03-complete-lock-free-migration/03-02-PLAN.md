---
phase: "03"
plan: "02"
type: "fix"
wave: "1"
depends_on: ["03-01"]
files_modified: ["src/core/Engine.h"]
autonomous: true
---

must_haves:
  truths:
    - "Engine.h provides isExecutingScript() convenience method"
    - "Engine.h provides commandsBeingProcessed() convenience method"
    - "Code compiles without errors"
  artifacts:
    - path: "src/core/Engine.h"
      provides: "Engine header with convenience methods"
      min_lines: 505
  key_links:
    - from: "Engine.h::isExecutingScript()"
      to: "Engine.h::isInUnsafeState()"
      via: "delegation"
      pattern: "isInUnsafeState()"
    - from: "Engine.h::commandsBeingProcessed()"
      to: "Engine.h::isInUnsafeState()"
      via: "delegation"
      pattern: "isInUnsafeState()"

<objective>
Add convenience methods to Engine.h for backward compatibility after Phase 3 refactoring.

Purpose: The Phase 3 refactoring removed `isExecutingScript()` and `commandsBeingProcessed()` methods, breaking callers in ofApp.cpp and CodeShell.cpp. This fix adds them back as thin wrappers around `isInUnsafeState()`.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md

# Gap context
Phase 3 removed isExecutingScript() and commandsBeingProcessed() from Engine.h
5 call sites across 4 files now fail to compile:
- src/ofApp.cpp:428
- src/shell/CodeShell.cpp:315
- src/gui/MultiSamplerGUI.cpp:154, 2249
- src/gui/ModuleGUI.cpp:481

# Solution
Add convenience methods that delegate to isInUnsafeState():
- isExecutingScript() → isInUnsafeState()
- commandsBeingProcessed() → isInUnsafeState()

This works because isInUnsafeState() checks notifyingObservers_ which is set during BOTH script execution AND command processing.
</context>

<tasks>

<task type="auto">
  <name>Add isExecutingScript() convenience method to Engine.h</name>
  <files>src/core/Engine.h</files>
  <action>
    Find isInUnsafeState() in Engine.h (around line 504-510).

    Add these methods AFTER isInUnsafeState() declaration:

    ```cpp
    // Convenience methods for backward compatibility (Phase 3.2 fix)
    // These delegate to isInUnsafeState() which checks notifyingObservers_
    bool isExecutingScript() const {
        return isInUnsafeState();
    }

    bool commandsBeingProcessed() const {
        return isInUnsafeState();
    }
    ```

    The exact line depends on current Engine.h structure. Find appropriate location after isInUnsafeState() method.
  </action>
  <verify>
    grep -n "isExecutingScript\|commandsBeingProcessed" src/core/Engine.h
    echo "PASS: Convenience methods added" || echo "FAIL: Methods not found"
  </verify>
  <done>
    Engine.h has isExecutingScript() and commandsBeingProcessed() convenience methods
  </done>
</task>

</tasks>

<verification>
1. grep confirms isExecutingScript() in Engine.h
2. grep confirms commandsBeingProcessed() in Engine.h
3. Code compiles without errors (build test)
</verification>

<success_criteria>
- [ ] Engine.h has isExecutingScript() method
- [ ] Engine.h has commandsBeingProcessed() method
- [ ] Both delegate to isInUnsafeState()
- [ ] Code compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/03-complete-lock-free-migration/03-02-SUMMARY.md`
</output>
