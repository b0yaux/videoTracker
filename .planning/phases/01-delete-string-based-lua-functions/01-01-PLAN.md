---
phase: 01-delete-string-based-lua-functions
plan: "01"
type: execute
wave: 1
depends_on: []
files_modified:
  - src/core/Engine.cpp
autonomous: true
user_setup: []

must_haves:
  truths:
    - "Lua scripts can use SWIG bindings directly (sampler, sequencer, connect, setParam, etc.)"
    - "No string parsing overhead during Lua function calls"
    - "Engine.cpp compiles without errors"
  artifacts:
    - path: "src/core/Engine.cpp"
      provides: "Clean setupLua() without registerHelpers string"
      min_lines: 50
  key_links:
    - from: "src/core/Engine.cpp"
      to: "videoTracker.i"
      via: "SWIG bindings available globally"
      pattern: "sampler\\(|sequencer\\(|connect\\(|setParam\\("
---

<objective>
Delete redundant string-based Lua helper functions from Engine::setupLua().

**Purpose**: Eliminate ~160 lines of string parsing overhead. SWIG bindings in `videoTracker.i` already provide `sampler()`, `sequencer()`, `connect()`, `setParam()`, `audioOut()`, `videoOut()`, `oscilloscope()`, `spectrogram()`, `pattern()` functions directly.

**Output**: Clean `setupLua()` function that only registers `exec()` command, relying on SWIG for helper functions.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md

# Code reference
@src/core/Engine.cpp
  - setupLua() function at line 314
  - registerHelpers string at lines 344-500
  - doString call at line 501
  - Log message at line 503 to update
</context>

<tasks>

<task type="auto">
  <name>Delete registerHelpers string block from setupLua()</name>
  <files>src/core/Engine.cpp</files>
  <action>
    Delete lines 344-501 from src/core/Engine.cpp. This includes:
    
    - The entire `std::string registerHelpers = R"( ... )"` multi-line string literal (lines 344-500)
    - The `lua_->doString(registerHelpers);` call (line 501)
    
    After deletion, the setupLua() function should:
    1. Keep the `lua_register(L, "exec", lua_execCommand);` call at line 340
    2. Skip directly to the log message at line 503
    
    DO NOT modify the log message yet - that's a separate task.
  </action>
  <verify>
    grep -n "registerHelpers\|doString(registerHelpers)" src/core/Engine.cpp
    # Should return: no matches found
    
    grep -n "lua_register.*exec" src/core/Engine.cpp
    # Should return: line with lua_register still present
  </verify>
  <done>
    Lines 344-501 removed from Engine.cpp, setupLua() now just registers exec() function
  </done>
</task>

<task type="auto">
  <name>Update log message to reflect new behavior</name>
  <files>src/core/Engine.cpp</files>
  <action>
    Update the log message in setupLua() that was at line 503 (now a lower line number after deletion).
    
    OLD message:
    ```
    ofLogNotice("Engine") << "Lua initialized successfully - exec() and helper functions registered";
    ```
    
    NEW message:
    ```
    ofLogNotice("Engine") << "Lua initialized successfully - using SWIG bindings for helper functions";
    ```
    
    The message should reflect that helper functions come from SWIG bindings, not from the deleted string.
  </action>
  <verify>
    grep -n "SWIG bindings" src/core/Engine.cpp
    # Should return: 1 match with updated message
    
    grep -v "helper functions registered" src/core/Engine.cpp
    # Should return: no matches (old string gone)
  </verify>
  <done>
    Log message updated to reference SWIG bindings instead of registered helper functions
  </done>
</task>

</tasks>

<verification>
1. **Compilation check:**
   ```bash
   cd /Users/jaufre/works/of_v0.12.1_osx_release/apps/myApps/videoTracker && make -j4 2>&1 | head -50
   ```
   Should compile without errors related to Engine.cpp changes.

2. **No orphaned references:**
   ```bash
   grep -r "registerHelpers\|doString(registerHelpers)" src/core/
   ```
   Should return no matches.
</verification>

<success_criteria>
- [ ] Lines 344-501 deleted from src/core/Engine.cpp
- [ ] Log message updated to mention SWIG bindings
- [ ] Compilation succeeds
- [ ] No references to registerHelpers remain in codebase
</success_criteria>

<output>
After completion, create `.planning/phases/01-delete-string-based-lua-functions/01-01-SUMMARY.md`
</output>
